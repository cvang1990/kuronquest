<!DOCTYPE html>
<html>
	<!-- Compiled and minified CSS -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

	<!-- Compiled and minified JavaScript for Materialize CSS -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
	<!-- CSV to JSON -->
	<script src="https://cdn.rawgit.com/Keyang/node-csvtojson/d41f44aa/browser/csvtojson.min.js"></script>


<body>
	<!-- CREATE SUPER -->
	<div class="row">
		<h2 style="text-align: center">Create Your Super</h2>
		<br>

		<!-- SUPER NAME -->
		<div class="col s12" style="text-align: center;">
			<h4 style="color: red;">Super Name</h4>
			<br>
		</div>
		<div class="col s3"></div>
		<div class="col s6">
			<input id="super_name" value="None"></input>
		</div>
		<div class="col s3"></div>
		<br>
		<div class="col s12">
			<br><br>
			<hr>
		</div>

		<!-- ALIGNMENT -->
		<div class="col s12" style="text-align: center;">
			<h4 style="color: red;">Alignment</h4>
			<br>
			<h5 id="alignment" class="">Hero</h5>
			<br>
		</div>
		<div class="col s7"></div>
		<!-- BUTTONS -->
		<div class="col s12">
			<div class="col s6" style="text-align: center;">
				<button class="waves-effect waves-light btn blue" style=" width: 50%; text-align: center" onclick="alignmenthero(this)" type="button">Hero</button>
			</div>
			<div class="col s6" style="text-align: center;">
				<button class="waves-effect waves-light btn blue" style=" width: 50%; text-align: center" onclick="alignmentvillain(this)" type="button">Villain</button>
			</div>
			<!-- <div class="col s4" style="text-align: center;">
				<button class="waves-effect waves-light btn blue" style=" width: 50%; text-align: center" onclick="gendergenderless(this)" type="button">Genderless</button>
			</div> -->
		</div>

	</div>
	<br><br>
	<hr>

	<div class="row">
		<div class="col s12" style="text-align: center;">
			<h4 style="color: red;">Ability & Defense</h4>
			<br>
		</div>
		<div class="col s4"></div>
		<div class="col s4">
			<h3 id="super_power_value" style="text-align: center;">Power: 8</h3>
		</div>
		<div class="col s4"></div>
		<div class="col s6">
			<div>
				<h4>Name Your Ability</h4>
				<input id="ability_name" value="None"></input>
			</div>
			<div>
				<h4>Selected Ability</h4>
				<h5 id="selected_ability_type">Type: None</h5>
				<h5 id="selected_ability_category">Category: None</h5>
				<h6 id="selected_ability_effect">Effect: None</h6>
			</div>

			<!-- Modal Trigger -->
			<a class="waves-effect waves-light btn modal-trigger" href="#modal-ability" >Select Ability</a>

			<p id="selected_filter_ability_skill_type" style="visibility: hidden"></p>
			<p id="selected_filter_ability_skill_category" style="visibility: hidden"></p>
			<p id="selected_ability_skill_id" style="visibility: hidden"></p>
			<p id="selected_ability_power_add" style="visibility: hidden">4</p>
		</div>
		<!-- <div class="col s6">
			Defense
		</div> -->
		<div class="col s6">
			<div>
				<h4>Name Your Defense</h4>
				<input id="defense_name" value="None"></input>
			</div>
			<div>
				<h4>Selected Defense</h4>
				<h5 id="selected_defense_type">Type: None</h5>
				<h5 id="selected_defense_category">Category: None</h5>
				<h6 id="selected_defense_effect">Effect: None</h6>
			</div>

			<!-- Modal Trigger -->
			<a class="waves-effect waves-light btn modal-trigger" href="#modal-defense">Select Defense</a>

			<p id="selected_filter_defense_skill_type" style="visibility: hidden"></p>
			<p id="selected_filter_defense_skill_category" style="visibility: hidden"></p>
			<p id="selected_defense_skill_id" style="visibility: hidden"></p>
			<p id="selected_defense_power_add" style="visibility: hidden">4</p>
		</div>

	</div>
	<!-- =================================================================== -->

	<!-- ABILITY MODAL -->
	<div id="modal-ability" class="modal">
		<div class="modal-content">
			<h4>Select Ability</h4>
			<div class="input-field col s6">
				<select id="ability_type_selection">
					<option value="All">All</option>
					<option value="Delayed">Delayed</option>
					<option value="Instant">Instant</option>
					<option value="None">None</option>
					<option value="Offensive">Offensive</option>
					<option value="Trigger">Trigger</option>
				</select>
				<label>Type</label>
			</div>
			<div class="input-field col s6">
				<select id="ability_category_selection">
					<option value="All">All</option>
					<option value="Discard">Discard</option>
					<option value="Draw">Draw</option>
					<option value="Flip">Flip</option>
					<option value="Increase Power">Increase Power</option>
					<option value="Negate">Negate</option>
					<option value="None">None</option>
				</select>
				<label>Category</label>
			</div>

			<div class="col s12 m2 push-m2 buttonclass">
				<button class="waves-effect waves-light btn" style="width: 45%; float: center; text-align: center" onclick="ability_filter(this)" type="button">Filter</button>
			<!-- </div>
			<div class="col s6 m2 push-m2 buttonclass"> -->
				<button class="waves-effect waves-light red btn" style="width: 45%; float: center; text-align: center" onclick="reset_filter(this)" type="button">Reset</button>
			</div>
			<p id="all_abilities"></p>

			<br><br><br><br>

		</div>
	</div>

	<!-- DEFENSE MODAL -->
	<div id="modal-defense" class="modal">
		<div class="modal-content">
			<h4>Select Defense</h4>
			<div class="input-field col s6">
				<select id="defense_type_selection">
					<option value="All">All</option>
					<option value="Delayed">Delayed</option>
					<option value="None">None</option>
					<option value="Passive">Passive</option>
					<option value="Trigger">Trigger</option>
				</select>
				<label>Type</label>
			</div>
			<div class="input-field col s6">
				<select id="defense_category_selection">
					<option value="All">All</option>
					<option value="Decrease Power">Decrease Power</option>
					<option value="Discard">Discard</option>
					<option value="Draw">Draw</option>
					<option value="Flip">Flip</option>
					<option value="Increase Power">Increase Power</option>
					<option value="Negate">Negate</option>
					<option value="None">None</option>
					<option value="Return">Return</option>
					<option value="Swap">Swap</option>
				</select>
				<label>Category</label>
			</div>

			<div class="col s12 m2 push-m2 buttonclass">
				<button class="waves-effect waves-light btn" style="width: 45%; float: center; text-align: center" onclick="defense_filter(this)" type="button">Filter</button>
			<!-- </div>
			<div class="col s6 m2 push-m2 buttonclass"> -->
				<button class="waves-effect waves-light red btn" style="width: 45%; float: center; text-align: center" onclick="reset_filter(this)" type="button">Reset</button>
			</div>
			<p id="all_defenses"></p>

			<br><br><br><br>

		</div>
	</div>
	<br><br>
	<hr>

	<div class="row">
		<div class="col s12" style="text-align: center;">
			<h4 style="color: red;">Description Of Your Super</h4>
			<br>
			<div class="col s1"></div>
			<div class="input-field col s9">
		        <textarea id="textarea1" class="materialize-textarea" id="super_description"></textarea>
	        </div>
			<div class="col s1"></div>
		</div>
	</div>
	<br><br>
	<hr>
	<div class="row">
		<div class="col s4"></div>
		<div class="col s4">
			<button class="waves-effect waves-light btn" style="width: 100%; float: center; text-align: center" onclick="display_super(this)" type="button">Display</button>
		</div>
		<div class="col s4"></div>
	</div>

		</div>
	<br><br><br><br>

	<script type="text/javascript">

		const alignments = ["Hero", "Villain"];

		// google sheets
		let url_abilities_defenses = "https://docs.google.com/spreadsheets/d/17hmcKte-Bx573Ce4-0y6BC3BX6rF8Y2QiyDNNMmx_78/export?format=csv";

		// ABILITY FILTER BUTTON
		const ability_filter = control => {
			let set_ab_type_selected = ""; // Resets to blank before setting
			let set_ab_category_selected = ""; // Resets to blank before setting
			let ab_type_selected;
			let ab_category_selected;
			let ability_skills = [];
			let ability_skill_list = [];

			set_ab_type_selected = document.getElementById("ability_type_selection").options[ability_type_selection.selectedIndex].text;
			set_ab_category_selected = document.getElementById("ability_category_selection").options[ability_category_selection.selectedIndex].text;

			document.getElementById("selected_filter_ability_skill_type").innerHTML = set_ab_type_selected;
			document.getElementById("selected_filter_ability_skill_category").innerHTML = set_ab_category_selected;

			ab_type_selected = document.getElementById("selected_filter_ability_skill_type").textContent;
			ab_category_selected = document.getElementById("selected_filter_ability_skill_category").textContent;
			// console.log(ab_type_selected);
			// console.log(ab_category_selected);

			// Fetch Abilities and set into Array
			fetch(url_abilities_defenses).then(result=>result.text()).then(function(csvtext) {
				return csv().fromString(csvtext);
			}).then(function(csv) {
				csv.forEach(function(row) {

					// set selected abilities based on filter
					if (row.skill_type != 'Defense') {
						if (ab_type_selected == 'All' && ab_category_selected == 'All') {
							ability_skills.push(row);
						} else if (ab_type_selected == row.type && ab_category_selected == row.category) {
							ability_skills.push(row);
						} else if (ab_type_selected == 'All' && ab_category_selected == row.category){
							ability_skills.push(row);
						} else if (ab_type_selected == row.type && ab_category_selected == 'All'){
							ability_skills.push(row);
						}
					}
				});

				// reset display area
				document.getElementById("all_abilities").innerHTML = ""

				// display based on selected type and category
				for (i=0; i <= ability_skills.length; i++) {
					document.getElementById("all_abilities").innerHTML += "<br><b>Type:</b> "
						+ ability_skills[i].type
						+ "<br><b>Category:</b> "
						+ ability_skills[i].category
						+ "<div><b>Effect:</b> "
						+ ability_skills[i].effects
						+ " <br><button class=\"waves-effect blue waves-light btn\" onclick=\"ability_selected("
						+ ability_skills[i].id
						+ ")\" type=\"button\">Select</button></div><hr>";
				}
			});
		}

		const ability_selected = ability_id => {
			// console.log(ability_id);
			let selected_ability_id = "";
			let selected_ability_effect = "";
			let selected_ability_type = "";
			let selected_ability_category = "";
			let selected_ability_power_add = "";
			let ability_power = "";
			let defense_power = document.getElementById("selected_defense_power_add").textContent;
			let super_power_val = 0;

			fetch(url_abilities_defenses).then(result=>result.text()).then(function(csvtext) {
				return csv().fromString(csvtext);
			}).then(function(csv) {
				csv.forEach(function(row) {

					// set selected abilities based on filter
					if (row.id == ability_id && row.skill_type != "Defense") {
						selected_ability_id = row.id;
						selected_ability_effect = row.effects;
						selected_ability_type = row.type;
						selected_ability_category = row.category;
						selected_ability_power_add = row.power_add;
					}
				});

				// display selected on non-modal
				document.getElementById("selected_ability_type").innerHTML = "Type: " + selected_ability_type;
				document.getElementById("selected_ability_category").innerHTML = "Category: " + selected_ability_category;
				document.getElementById("selected_ability_effect").innerHTML = "Effect: " + selected_ability_effect;
				// hidden values
				document.getElementById("selected_ability_skill_id").innerHTML = selected_ability_id;
				document.getElementById("selected_ability_power_add").innerHTML = selected_ability_power_add;
				// update power
				ability_power = selected_ability_power_add;
				super_power_val = parseFloat(ability_power) + parseFloat(defense_power);
				document.getElementById("super_power_value").innerHTML = "Power: " + Math.round(super_power_val);
				// console.log(super_power_val);
				// console.log(ability_power);
				// console.log(defense_power);
			});
		}
// ==============

		const defense_filter = control => {
			let set_def_type_selected = ""; // Resets to blank before setting
			let set_def_category_selected = ""; // Resets to blank before setting
			let def_type_selected;
			let def_category_selected;
			let defense_skills = [];
			let defense_skill_list = [];

			set_def_type_selected = document.getElementById("defense_type_selection").options[defense_type_selection.selectedIndex].text;
			set_def_category_selected = document.getElementById("defense_category_selection").options[defense_category_selection.selectedIndex].text;

			document.getElementById("selected_filter_defense_skill_type").innerHTML = set_def_type_selected;
			document.getElementById("selected_filter_defense_skill_category").innerHTML = set_def_category_selected;

			def_type_selected = document.getElementById("selected_filter_defense_skill_type").textContent;
			def_category_selected = document.getElementById("selected_filter_defense_skill_category").textContent;
			// console.log(ab_type_selected);
			// console.log(ab_category_selected);

			// Fetch Abilities and set into Array
			fetch(url_abilities_defenses).then(result=>result.text()).then(function(csvtext) {
				return csv().fromString(csvtext);
			}).then(function(csv) {
				csv.forEach(function(row) {

					// set selected abilities based on filter
					if (row.skill_type != 'Ability') {
						if (def_type_selected == 'All' && def_category_selected == 'All') {
							defense_skills.push(row);
						} else if (def_type_selected == row.type && def_category_selected == row.category) {
							defense_skills.push(row);
						} else if (def_type_selected == 'All' && def_category_selected == row.category){
							defense_skills.push(row);
						} else if (def_type_selected == row.type && def_category_selected == 'All'){
							defense_skills.push(row);
						}
					}
				});

				// reset display area
				document.getElementById("all_defenses").innerHTML = "";

				// display based on selected type and category
				for (i=0; i <= defense_skills.length; i++) {
					document.getElementById("all_defenses").innerHTML += "<br><b>Type:</b> "
						+ defense_skills[i].type
						+ "<br><b>Category:</b> "
						+ defense_skills[i].category
						+ "<div><b>Effect:</b> "
						+ defense_skills[i].effects
						+ " <br><button class=\"waves-effect blue waves-light btn\" onclick=\"defense_selected("
						+ defense_skills[i].id
						+ ")\" type=\"button\">Select</button></div><hr>";
				}
			});
		}

		const defense_selected = defense_id => {
			// console.log(ability_id);
			let selected_defense_id = "";
			let selected_defense_effect = "";
			let selected_defense_type = "";
			let selected_defense_category = "";
			let selected_defense_power_add = "";
			let ability_power = document.getElementById("selected_ability_power_add").textContent;
			let defense_power = "";
			let super_power_val = 0;

			fetch(url_abilities_defenses).then(result=>result.text()).then(function(csvtext) {
				return csv().fromString(csvtext);
			}).then(function(csv) {
				csv.forEach(function(row) {

					// set selected abilities based on filter
					if (row.id == defense_id && row.skill_type != "Ability") {
						selected_defense_id = row.id;
						selected_defense_effect = row.effects;
						selected_defense_type = row.type;
						selected_defense_category = row.category;
						selected_defense_power_add = row.power_add;
					}
				});

				// display selected on non-modal
				document.getElementById("selected_defense_type").innerHTML = "Type: " + selected_defense_type;
				document.getElementById("selected_defense_category").innerHTML = "Category: " + selected_defense_category;
				document.getElementById("selected_defense_effect").innerHTML = "Effect: " + selected_defense_effect;
				// hidden values
				document.getElementById("selected_defense_skill_id").innerHTML = selected_defense_id;
				document.getElementById("selected_defense_power_add").innerHTML = selected_defense_power_add;
				// update power
				defense_power = selected_defense_power_add;
				super_power_val = parseFloat(ability_power) + parseFloat(defense_power);
				document.getElementById("super_power_value").innerHTML = "Power: " + Math.round(super_power_val);
				// console.log(super_power_val);
				// console.log(ability_power);
				// console.log(defense_power);
			});
		}

		// MATERIALIZE CSS
		document.addEventListener('DOMContentLoaded', function() {
		    var elems = document.querySelectorAll('.modal');
		    var instances = M.Modal.init(elems);
		});
		document.addEventListener('DOMContentLoaded', function() {
		    var elems = document.querySelectorAll('select');
		    var instances = M.FormSelect.init(elems);
		});

 	</script>

	</body>

</html>
