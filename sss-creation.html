<!DOCTYPE html>
<html>
	<!-- Compiled and minified CSS -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

	<!-- Compiled and minified JavaScript for Materialize CSS -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
	<!-- CSV to JSON -->
	<script src="https://cdn.rawgit.com/Keyang/node-csvtojson/d41f44aa/browser/csvtojson.min.js"></script>

	<style media="screen">
		.container {
			position: relative;
			text-align: center;
			display: flex;
			justify-content: center;
			align-items: center;

			color: white;
		}

		.container-card-display {
			postion: relative;
			text-align: center;
			display: flex;
		    justify-content: center;
		    align-items: center;
			width: 100%;
		}

		.image-assets {
			position: absolute;
			top: 2000px;
			/* top: 268%; */
			bottom 50%;
			/* width: 810px; */
			width: 75%;
		}

		.base-card-text {
			position: absolute;
			bottom 50%;
			width:50%;
			/* width: 100px; */
			text-transform: uppercase;
			font-weight: bold;
			color: white;
		}

		.skill-card-text {
			/* font-size: 25px; */
			/* font-size: 100%; */
			-webkit-text-stroke: 1px black;
		}

		.text-super-name {
			top: 2500px;
			font-size: 50px;
			/* font-size: 500%; */
			-webkit-text-stroke: 5px black;
		}

		.text-ability-name {
			top: 2625px;
			/* top: 348%; */
			font-size: 40px;
			transform: translate(-10%, 0%);
			text-align: left;
		}

		.text-ability-effect {
			top: 2680px;
			font-size: 30px;
			transform: translate(-15%, 0%);
			text-align: left;
		}

		.text-defense-name {
			top: 2825px;
			font-size: 40px;
			transform: translate(10%, 0%);
			text-align: right;
		}

		.text-defense-effect {
			top: 2880px;
			font-size: 30px;
			transform: translate(15%, 0%);
			text-align: right;
		}
	</style>


<body>
	<!-- CREATE SUPER -->
	<div class="row">
		<!-- <h2 style="text-align: center">Create Your Super</h2> -->
		<br>

		<!-- SUPER NAME -->
		<div class="col s12" style="text-align: center;">
			<h4 style="color: red;">Super Name</h4>
			<br>
		</div>
		<div class="col s3"></div>
		<div class="col s6">
			<input id="super_name" value="None"></input>
		</div>
		<div class="col s3"></div>
		<br>
		<div class="col s12">
			<br><br>
			<hr>
		</div>

		<!-- ALIGNMENT -->
		<div class="col s12" style="text-align: center;">
			<h4 style="color: red;">Alignment</h4>
			<br>
			<h5 id="alignment" class="">Hero</h5>
			<br>
		</div>
		<div class="col s7"></div>
		<!-- BUTTONS -->
		<div class="col s12">
			<div class="col s6" style="text-align: center;">
				<button class="waves-effect waves-light btn blue" style=" width: 50%; text-align: center" onclick="alignmenthero(this)" type="button">Hero</button>
			</div>
			<div class="col s6" style="text-align: center;">
				<button class="waves-effect waves-light btn blue" style=" width: 50%; text-align: center" onclick="alignmentvillain(this)" type="button">Villain</button>
			</div>
		</div>

	</div>
	<br><br>
	<hr>

	<div class="row">
		<div class="col s12" style="text-align: center;">
			<h4 style="color: red;">Ability & Defense</h4>
			<br>
		</div>
		<div class="col s4"></div>
		<div class="col s4">
			<h3 style="text-align: center;">Power: <span id="super_power_value">8</span></h3>
		</div>
		<div class="col s4"></div>
		<div class="col s6">
			<div>
				<h4>Name Your Ability</h4>
				<input id="ability_name" value="None"></input>
			</div>
			<div>
				<h4>Selected Ability</h4>
				<h5>Type: <span id="selected_ability_type">None</span></h5>
				<h5>Category: <span id="selected_ability_category">None</span></h5>
				<h6>Effect: <span id="selected_ability_effect">None</span></h6>
			</div>

			<!-- Modal Trigger -->
			<a class="waves-effect waves-light btn modal-trigger" href="#modal-ability" >Select Ability</a>

			<p id="selected_filter_ability_skill_type" style="visibility: hidden"></p>
			<p id="selected_filter_ability_skill_category" style="visibility: hidden"></p>
			<p id="selected_ability_skill_id" style="visibility: hidden"></p>
			<p id="selected_ability_power_add" style="visibility: hidden">4</p>
		</div>
		<div class="col s6">
			<div>
				<h4>Name Your Defense</h4>
				<input id="defense_name" value="None"></input>
			</div>
			<div>
				<h4>Selected Defense</h4>
				<h5>Type: <span id="selected_defense_type">None</span></h5>
				<h5>Category: <span id="selected_defense_category">None</span></h5>
				<h6>Effect: <span id="selected_defense_effect">None</span></h6>
			</div>

			<!-- Modal Trigger -->
			<a class="waves-effect waves-light btn modal-trigger" href="#modal-defense">Select Defense</a>

			<p id="selected_filter_defense_skill_type" style="visibility: hidden"></p>
			<p id="selected_filter_defense_skill_category" style="visibility: hidden"></p>
			<p id="selected_defense_skill_id" style="visibility: hidden"></p>
			<p id="selected_defense_power_add" style="visibility: hidden">4</p>
		</div>

	</div>

	<!-- ABILITY MODAL -->
	<div id="modal-ability" class="modal">
		<div class="modal-content">
			<h4>Select Ability</h4>
			<div class="input-field col s6">
				<select id="ability_type_selection">
					<option value="All">All</option>
					<option value="Delayed">Delayed</option>
					<option value="Instant">Instant</option>
					<option value="None">None</option>
					<option value="Offensive">Offensive</option>
					<option value="Trigger">Trigger</option>
				</select>
				<label>Type</label>
			</div>
			<div class="input-field col s6">
				<select id="ability_category_selection">
					<option value="All">All</option>
					<option value="Discard">Discard</option>
					<option value="Draw">Draw</option>
					<option value="Flip">Flip</option>
					<option value="Increase Power">Increase Power</option>
					<option value="Negate">Negate</option>
					<option value="None">None</option>
				</select>
				<label>Category</label>
			</div>

			<div class="col s12 m2 push-m2 buttonclass">
				<button class="waves-effect waves-light btn" style="width: 45%; float: center; text-align: center" onclick="ability_filter(this)" type="button">Filter</button>
			<!-- </div>
			<div class="col s6 m2 push-m2 buttonclass"> -->
				<button class="waves-effect waves-light red btn" style="width: 45%; float: center; text-align: center" onclick="reset_filter_ability(this)" type="button">Reset</button>
			</div>
			<p id="all_abilities"></p>

			<br><br><br><br>

		</div>
	</div>

	<!-- DEFENSE MODAL -->
	<div id="modal-defense" class="modal">
		<div class="modal-content">
			<h4>Select Defense</h4>
			<div class="input-field col s6">
				<select id="defense_type_selection">
					<option value="All">All</option>
					<option value="Delayed">Delayed</option>
					<option value="None">None</option>
					<option value="Passive">Passive</option>
					<option value="Trigger">Trigger</option>
				</select>
				<label>Type</label>
			</div>
			<div class="input-field col s6">
				<select id="defense_category_selection">
					<option value="All">All</option>
					<option value="Decrease Power">Decrease Power</option>
					<option value="Discard">Discard</option>
					<option value="Draw">Draw</option>
					<option value="Flip">Flip</option>
					<option value="Increase Power">Increase Power</option>
					<option value="Negate">Negate</option>
					<option value="None">None</option>
					<option value="Return">Return</option>
					<option value="Swap">Swap</option>
				</select>
				<label>Category</label>
			</div>

			<div class="col s12 m2 push-m2 buttonclass">
				<button class="waves-effect waves-light btn" style="width: 45%; float: center; text-align: center" onclick="defense_filter(this)" type="button">Filter</button>
			<!-- </div>
			<div class="col s6 m2 push-m2 buttonclass"> -->
				<button class="waves-effect waves-light red btn" style="width: 45%; float: center; text-align: center" onclick="reset_filter_defense(this)" type="button">Reset</button>
			</div>
			<p id="all_defenses"></p>

			<br><br><br><br>

		</div>
	</div>
	<br><br>
	<hr>

	<div class="row" style="text-align: center;">
		<div class="col s12">
			<h4 style="color: red;">Description Of Your Super</h4>
			<br>
			<!-- SUPER POWERS -->
			<div class="row">
				<div class="col s2"></div>
				<div class="input-field col s8">
					<textarea class="materialize-textarea" id="super_powers_description"></textarea>
					<label for="">Super Powers</label>
				</div>
				<div class="col s2"> </div>
			</div>

			<!-- SUIT COLORS -->
			<div class="row">
				<div class="col s2"></div>
				<div class="input-field col s8">
					<textarea class="materialize-textarea" id="suit_colors_description"></textarea>
					<label for="">Suit Colors</label>
				</div>
				<div class="col s2"></div>
			</div>

			<!-- PHYSICAL FEATURES -->
			<div class="row">
				<div class="col s2"></div>
				<div class="input-field col s8">
					<textarea class="materialize-textarea" id="physical_features_description"></textarea>
					<label for="">Physical Features</label>
				</div>
				<div class="col s2"></div>
			</div>

			<!-- RACE -->
			<div class="row">
				<div class="col s2"></div>
				<div class="input-field col s8">
					<textarea class="materialize-textarea" id="race_description"></textarea>
					<label for="">Race</label>
				</div>
				<div class="col s2"></div>
			</div>

			<!-- GENDER -->
			<div class="row">
				<div class="col s2"></div>
				<div class="input-field col s8">
					<textarea class="materialize-textarea" id="gender_description"></textarea>
					<label for="">Gender</label>
				</div>
				<div class="col s2"></div>
			</div>

		</div>
	</div>
	<br><br>
	<hr>
	<div class="row">
		<div class="col s4"></div>
		<div class="col s4">
			<button class="waves-effect waves-light btn" style="width: 100%; float: center; text-align: center" onclick="display_super(this)" type="button">Display</button>
		</div>
		<div class="col s4"></div>
		<!-- inputs for 1. main suit colors, 2. describe super powers, 3. gender, 4. describe physical features, 5. other additional information -->
	</div>

		</div>

	<br>
	<div class="container container-card-display" id="card_display_layout">

	</div>
	<br><br><br><br>

	<script type="text/javascript">

		const alignments = ["Hero", "Villain"];

		// CREATE CARD ASSETS
		const base_card = "https://drive.google.com/uc?export=view&id=1pcvbGcktqmoXuMu547BtH8A_25gUPDOT";

		// GOOGLE SHEETS URL
		let url_abilities_defenses = "https://docs.google.com/spreadsheets/d/17hmcKte-Bx573Ce4-0y6BC3BX6rF8Y2QiyDNNMmx_78/export?format=csv";
		let url_create_card_assets = "https://docs.google.com/spreadsheets/d/1EsQJtOvSWhus9-tmgvwqv2ndYt5LXsgqSgwo2IHxPGk/export?format=csv";

		// ALIGNMENT SELECTION
		const alignmenthero = control => {
			document.getElementById("alignment").innerHTML = alignments[0];
			console.log("Set alignment to \"" + alignments[0] + "\".");
		}

		const alignmentvillain = control => {
			document.getElementById("alignment").innerHTML = alignments[1];
			console.log("Set alignment to \"" + alignments[1] + "\".");
		}

		// ABILITY FILTER BUTTON
		const ability_filter = control => {
			let set_ab_type_selected = ""; // Resets to blank before setting
			let set_ab_category_selected = ""; // Resets to blank before setting
			let ab_type_selected;
			let ab_category_selected;
			let ability_skills = [];
			let ability_skill_list = [];

			set_ab_type_selected = document.getElementById("ability_type_selection").options[ability_type_selection.selectedIndex].text;
			set_ab_category_selected = document.getElementById("ability_category_selection").options[ability_category_selection.selectedIndex].text;

			document.getElementById("selected_filter_ability_skill_type").innerHTML = set_ab_type_selected;
			document.getElementById("selected_filter_ability_skill_category").innerHTML = set_ab_category_selected;

			ab_type_selected = document.getElementById("selected_filter_ability_skill_type").textContent;
			ab_category_selected = document.getElementById("selected_filter_ability_skill_category").textContent;
			// console.log(ab_type_selected);
			// console.log(ab_category_selected);

			// Fetch Abilities and set into Array
			fetch(url_abilities_defenses).then(result=>result.text()).then(function(csvtext) {
				return csv().fromString(csvtext);
			}).then(function(csv) {
				csv.forEach(function(row) {

					// set selected abilities based on filter
					if (row.skill_type != 'Defense') {
						if (ab_type_selected == 'All' && ab_category_selected == 'All') {
							ability_skills.push(row);
						} else if (ab_type_selected == row.type && ab_category_selected == row.category) {
							ability_skills.push(row);
						} else if (ab_type_selected == 'All' && ab_category_selected == row.category){
							ability_skills.push(row);
						} else if (ab_type_selected == row.type && ab_category_selected == 'All'){
							ability_skills.push(row);
						}
					}
				});

				// reset display area
				document.getElementById("all_abilities").innerHTML = ""

				// display based on selected type and category
				for (i=0; i <= ability_skills.length; i++) {
					document.getElementById("all_abilities").innerHTML += "<br><b>Type:</b> "
						+ ability_skills[i].type
						+ "<br><b>Category:</b> "
						+ ability_skills[i].category
						+ "<div><b>Effect:</b> "
						+ ability_skills[i].effects
						+ " <br><button class=\"waves-effect blue waves-light btn\" onclick=\"ability_selected("
						+ ability_skills[i].id
						+ ")\" type=\"button\">Select</button></div><hr>";
				}
			});
		}

		const ability_selected = ability_id => {
			// console.log(ability_id);
			let selected_ability_id = "";
			let selected_ability_effect = "";
			let selected_ability_type = "";
			let selected_ability_category = "";
			let selected_ability_power_add = "";
			let ability_power = "";
			let defense_power = document.getElementById("selected_defense_power_add").textContent;
			let super_power_val = 0;

			fetch(url_abilities_defenses).then(result=>result.text()).then(function(csvtext) {
				return csv().fromString(csvtext);
			}).then(function(csv) {
				csv.forEach(function(row) {

					// set selected abilities based on filter
					if (row.id == ability_id && row.skill_type != "Defense") {
						selected_ability_id = row.id;
						selected_ability_effect = row.effects;
						selected_ability_type = row.type;
						selected_ability_category = row.category;
						selected_ability_power_add = row.power_add;
					}
				});

				// display selected on non-modal
				document.getElementById("selected_ability_type").innerHTML = selected_ability_type;
				document.getElementById("selected_ability_category").innerHTML = selected_ability_category;
				document.getElementById("selected_ability_effect").innerHTML = selected_ability_effect;
				// hidden values
				document.getElementById("selected_ability_skill_id").innerHTML = selected_ability_id;
				document.getElementById("selected_ability_power_add").innerHTML = selected_ability_power_add;
				// update power
				ability_power = selected_ability_power_add;
				super_power_val = parseFloat(ability_power) + parseFloat(defense_power);
				document.getElementById("super_power_value").innerHTML = Math.round(super_power_val);
				// console.log(super_power_val);
				// console.log(ability_power);
				// console.log(defense_power);

				console.log("Set ability effect to \"" + selected_ability_effect + "\".");
			});
		}

		// DEFENSE FILTER BUTTON
		const defense_filter = control => {
			let set_def_type_selected = ""; // Resets to blank before setting
			let set_def_category_selected = ""; // Resets to blank before setting
			let def_type_selected;
			let def_category_selected;
			let defense_skills = [];
			let defense_skill_list = [];

			set_def_type_selected = document.getElementById("defense_type_selection").options[defense_type_selection.selectedIndex].text;
			set_def_category_selected = document.getElementById("defense_category_selection").options[defense_category_selection.selectedIndex].text;

			document.getElementById("selected_filter_defense_skill_type").innerHTML = set_def_type_selected;
			document.getElementById("selected_filter_defense_skill_category").innerHTML = set_def_category_selected;

			def_type_selected = document.getElementById("selected_filter_defense_skill_type").textContent;
			def_category_selected = document.getElementById("selected_filter_defense_skill_category").textContent;
			// console.log(ab_type_selected);
			// console.log(ab_category_selected);

			// Fetch Abilities and set into Array
			fetch(url_abilities_defenses).then(result=>result.text()).then(function(csvtext) {
				return csv().fromString(csvtext);
			}).then(function(csv) {
				csv.forEach(function(row) {

					// set selected abilities based on filter
					if (row.skill_type != 'Ability') {
						if (def_type_selected == 'All' && def_category_selected == 'All') {
							defense_skills.push(row);
						} else if (def_type_selected == row.type && def_category_selected == row.category) {
							defense_skills.push(row);
						} else if (def_type_selected == 'All' && def_category_selected == row.category){
							defense_skills.push(row);
						} else if (def_type_selected == row.type && def_category_selected == 'All'){
							defense_skills.push(row);
						}
					}
				});

				// reset display area
				document.getElementById("all_defenses").innerHTML = "";

				// display based on selected type and category
				for (i=0; i <= defense_skills.length; i++) {
					document.getElementById("all_defenses").innerHTML += "<br><b>Type:</b> "
						+ defense_skills[i].type
						+ "<br><b>Category:</b> "
						+ defense_skills[i].category
						+ "<div><b>Effect:</b> "
						+ defense_skills[i].effects
						+ " <br><button class=\"waves-effect blue waves-light btn\" onclick=\"defense_selected("
						+ defense_skills[i].id
						+ ")\" type=\"button\">Select</button></div><hr>";
				}

			});
		}

		const defense_selected = defense_id => {
			// console.log(ability_id);
			let selected_defense_id = "";
			let selected_defense_effect = "";
			let selected_defense_type = "";
			let selected_defense_category = "";
			let selected_defense_power_add = "";
			let ability_power = document.getElementById("selected_ability_power_add").textContent;
			let defense_power = "";
			let super_power_val = 0;

			fetch(url_abilities_defenses).then(result=>result.text()).then(function(csvtext) {
				return csv().fromString(csvtext);
			}).then(function(csv) {
				csv.forEach(function(row) {

					// set selected abilities based on filter
					if (row.id == defense_id && row.skill_type != "Ability") {
						selected_defense_id = row.id;
						selected_defense_effect = row.effects;
						selected_defense_type = row.type;
						selected_defense_category = row.category;
						selected_defense_power_add = row.power_add;
					}
				});

				// display selected on non-modal
				document.getElementById("selected_defense_type").innerHTML = selected_defense_type;
				document.getElementById("selected_defense_category").innerHTML = selected_defense_category;
				document.getElementById("selected_defense_effect").innerHTML = selected_defense_effect;
				// hidden values
				document.getElementById("selected_defense_skill_id").innerHTML = selected_defense_id;
				document.getElementById("selected_defense_power_add").innerHTML = selected_defense_power_add;
				// update power
				defense_power = selected_defense_power_add;
				super_power_val = parseFloat(ability_power) + parseFloat(defense_power);
				document.getElementById("super_power_value").innerHTML = Math.round(super_power_val);
				// console.log(super_power_val);
				// console.log(ability_power);
				// console.log(defense_power);

				console.log("Set defense effect to \"" + selected_defense_effect + "\".");
			});
		}

		const reset_filter_ability = control => {
			document.getElementById("all_abilities").innerHTML = "";
		}

		const reset_filter_defense = control => {
			document.getElementById("all_defenses").innerHTML = "";
		}

		const display_super = control => {
			let super_name = document.getElementById("super_name").value;
			let alignment = document.getElementById("alignment").textContent;
			let ability_name = document.getElementById("ability_name").value;
			let ability_type = document.getElementById("selected_ability_type").textContent;
			let ability_effect = document.getElementById("selected_ability_effect").textContent;
			let defense_name = document.getElementById("defense_name").value;
			let defense_type = document.getElementById("selected_defense_type").textContent;
			let defense_effect = document.getElementById("selected_defense_effect").textContent;
			let power = document.getElementById("super_power_value").textContent;
			let ability_id = document.getElementById("selected_ability_skill_id").textContent;
			let defense_id = document.getElementById("selected_defense_skill_id").textContent;

			let card_asset_items = [];
			let card_base_layout;
			let set_card_asset_alignment;
			let set_card_asset_power_value;
			let set_card_asset_ability_type;
			let set_card_asset_defense_type;
			let set_super_name;
			let set_ability_name;
			let set_ability_effect;
			let set_defense_name;
			let set_defense_effect;

			// reset card display
			document.getElementById("card_display_layout").innerHTML = "";

			// card_display_layout
			fetch(url_create_card_assets).then(result=>result.text()).then(function(csvtext) {
				return csv().fromString(csvtext);
			}).then(function(csv) {
				csv.forEach(function(row) {

					card_asset_items.push(row);

				});

				// SET CARD ASSETS
				// CARD TEMPLATE
				card_base_layout = "<img src=\""
					+ card_asset_items[0].asset_image
					+ "\" alt=\"card template - create\" class=\"image-assets\">";

				// ALIGNMENT
				for (i=0; i < card_asset_items.length; i++) {
					if (card_asset_items[i].card_asset == "Alignment" && card_asset_items[i].value == alignment) {
						// console.log(card_asset_items[i].asset_image);
						set_card_asset_alignment = "<img src=\""
							+ card_asset_items[i].asset_image
							+ "\" alt=\"card template - create\" class=\"image-assets\">";
					}
				};

				// POWER VALUE
				for (i=0; i < card_asset_items.length; i++) {
					if (card_asset_items[i].card_asset == "Power Value" && card_asset_items[i].value == power) {
						// console.log(card_asset_items[i].asset_image);
						set_card_asset_power_value = "<img src=\""
							+ card_asset_items[i].asset_image
							+ "\" alt=\"card template - create\" class=\"image-assets\">";
					}
				};

				// ABILITY TYPE
				for (i=0; i < card_asset_items.length; i++) {
					if (card_asset_items[i].card_asset == "Ability Type" && card_asset_items[i].value == ability_type) {
						// console.log(card_asset_items[i].asset_image);
						set_card_asset_ability_type = "<img src=\""
							+ card_asset_items[i].asset_image
							+ "\" alt=\"card template - create\" class=\"image-assets\">";
					}
				};

				// DEFENSE TYPE
				for (i=0; i < card_asset_items.length; i++) {
					if (card_asset_items[i].card_asset == "Defense Type" && card_asset_items[i].value == defense_type) {
						console.log(card_asset_items[i].asset_image);
						set_card_asset_defense_type = "<img src=\""
							+ card_asset_items[i].asset_image
							+ "\" alt=\"card template - create\" class=\"image-assets\">";
					}
				};

				set_super_name = "<div class=\"text-super-name base-card-text\">" + super_name + "</div>";
				set_ability_name = "<div class=\"skill-card-text base-card-text text-ability-name\">" + ability_name + "</div>";
				set_ability_effect = "<div class=\"skill-card-text base-card-text text-ability-effect\">" + ability_effect + "</div>";
				set_defense_name = "<div class=\"skill-card-text base-card-text text-defense-name\">" + defense_name + "</div>";
				set_defense_effect = "<div class=\"skill-card-text base-card-text text-defense-effect\">" + defense_effect + "</div>";

				// SETUP CARD
				document.getElementById("card_display_layout").innerHTML = card_base_layout;
				document.getElementById("card_display_layout").innerHTML += set_card_asset_alignment;
				document.getElementById("card_display_layout").innerHTML += set_card_asset_power_value;
				document.getElementById("card_display_layout").innerHTML += set_card_asset_ability_type;
				document.getElementById("card_display_layout").innerHTML += set_card_asset_defense_type;
				document.getElementById("card_display_layout").innerHTML += set_super_name;
				document.getElementById("card_display_layout").innerHTML += set_ability_name;
				document.getElementById("card_display_layout").innerHTML += set_ability_effect;
				document.getElementById("card_display_layout").innerHTML += set_defense_name;
				document.getElementById("card_display_layout").innerHTML += set_defense_effect;

				console.log("Display card generated.");
			});

		}

		// MATERIALIZE CSS
		document.addEventListener('DOMContentLoaded', function() {
		    var elems = document.querySelectorAll('.modal');
		    var instances = M.Modal.init(elems);
		});
		document.addEventListener('DOMContentLoaded', function() {
		    var elems = document.querySelectorAll('select');
		    var instances = M.FormSelect.init(elems);
		});

 	</script>

	</body>

</html>
