<!DOCTYPE html>
<html>
	<!-- Compiled and minified CSS -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

	<!-- Compiled and minified JavaScript -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    <!-- CSV to JSON -->
	<script src="https://cdn.rawgit.com/Keyang/node-csvtojson/d41f44aa/browser/csvtojson.min.js"></script>

	<style media="screen">
		.text-hidden {
			visibility: hidden;
		}

		img {
			border-radius: 40px;
			width: 80%;
			padding: 15px;
		}
	</style>

<body>

	<div class="row">
		<div class="col s3"></div>
		<div class="search-wrap col s6">
			<label for="search">Search Card</label>
			<input type="search" id="search" data-search>
		</div>
	</div>

	<div class="row">
			<div class="card-container col s12" data-cards-container>
			</div>
			<template id="cards-temp" data-template>
				<div class="col s4">
					<div class="cards">
						<div class="header text-hidden" data-header>1</div>
						<div class="body text-hidden" data-body>2</div>
						<div class="deck-type text-hidden" data-deck-type>3</div>
						<div class="card-type text-hidden" data-card-type>4</div>
						<div class="image cardsimage" data-image>5</div>
					</div>
				</div>
			</template>
	</div>


    <script type="text/javascript">
        let abilities = [];
        let cardlist = [];

        // google sheets
		let url_race_a_w = "https://docs.google.com/spreadsheets/d/1aTyNDibWsFQvNRUaCXVcXgTkYJrT_F7GALz9GSKEXGU/export?format=csv";
		let url_all_cards = "https://docs.google.com/spreadsheets/d/1ixqqyXdeQCs4b4gEkqyYlvKl-e6ZdkWZkME3NIJg5nY/export?format=csv";


        const cardTemplate = document.querySelector("[data-template]");
        const cardContainer = document.querySelector("[data-cards-container]");
        const searchInput = document.querySelector("[data-search]");

        searchInput.addEventListener("input", (e) => {
            const value = e.target.value.toLowerCase();
            // console.log(cardlist);
            cardlist.forEach(card => {
                const isVisible = card.name.toLowerCase().includes(value) ||
                    card.effect.toLowerCase().includes(value);
                card.element.classList.toggle("hide", !isVisible);
            })
        })

		// Fetch Abilities and set into Array
		fetch(url_all_cards).then(result=>result.text()).then(function(csvtext) {
			return csv().fromString(csvtext);
		}).then(function(csv) {
			cardlist = csv.map(function(row) {
                const card = cardTemplate.content.cloneNode(true).children[0];
                const header = card.querySelector("[data-header]");
                const body = card.querySelector("[data-body]");
				const deck_type = card.querySelector("[data-deck-type]");
				const card_type = card.querySelector("[data-card-type]");
				const image = card.querySelector("[data-image]");
                header.textContent = row.name;
                body.textContent = row.effect;
				deck_type.textContent = row.deck_type;
				card_type.textContent = row.card_type;
				image.innerHTML = "<img src=\"https://drive.google.com/uc?export=view&id=" + row.url_id + "\" alt=\"" + row.name + "\">";
                cardContainer.append(card);
                return{name: row.name, effect: row.effect, deck_type: row.deck_type, card_type: row.card_type, url_id: "<img src=\"https://drive.google.com/uc?export=view&id=" + row.url_id + "\" alt=\"" + row.name + "\">", element: card}
			})
		});

    </script>
</body>
</html>
